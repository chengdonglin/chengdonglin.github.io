import{_ as s,c as i,o as a,a3 as n}from"./chunks/framework.pgMqRpUO.js";const e="/assets/pod_describe.CbfZZBlR.png",u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"column/cloud_native/k8s/001_env_init.md","filePath":"column/cloud_native/k8s/001_env_init.md"}'),t={name:"column/cloud_native/k8s/001_env_init.md"},l=n(`<h2 id="基于-minikube-初始化-k8s-环境" tabindex="-1">基于 minikube 初始化 K8s 环境 <a class="header-anchor" href="#基于-minikube-初始化-k8s-环境" aria-label="Permalink to &quot;基于 minikube 初始化 K8s 环境&quot;">​</a></h2><p>Minikube 可以在本地机器上模拟一个完整的 Kubernetes 环境，从而进行开发、测试和学习，无需依赖云服务或远程集群。这使得 Kubernetes 的学习曲线变得更平缓，并且方便开发人员在本地调试和测试他们的应用程序</p><h3 id="常见的问题" tabindex="-1">常见的问题 <a class="header-anchor" href="#常见的问题" aria-label="Permalink to &quot;常见的问题&quot;">​</a></h3><p>在使用 minikube 的时候我们经常会遇到各种问题，比如</p><ol><li>docker 不能使用 root 用户</li><li>下载镜像失败</li></ol><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Unable to find image &#39;gcr.io/k8s-minikube/kicbase:v0.0.44@sha256:eb04641328b06c5c4a14f4348470e1046bbcf9c2cbc551486e343d3a49db557e&#39; locally</span></span>
<span class="line"><span>docker: Error response from daemon: Get &quot;https://gcr.io/v2/&quot;: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)</span></span></code></pre></div><h3 id="搭建流程" tabindex="-1">搭建流程 <a class="header-anchor" href="#搭建流程" aria-label="Permalink to &quot;搭建流程&quot;">​</a></h3><h4 id="安装-minikube" tabindex="-1">安装 minikube <a class="header-anchor" href="#安装-minikube" aria-label="Permalink to &quot;安装 minikube&quot;">​</a></h4><p>各种平台安装参考官方文档(<a href="https://minikube.sigs.k8s.io/docs/start/?arch=%2Flinux%2Fx86-64%2Fstable%2Fbinary+download" target="_blank" rel="noreferrer">https://minikube.sigs.k8s.io/docs/start/?arch=%2Flinux%2Fx86-64%2Fstable%2Fbinary+download</a>)</p><p>以下命令是 linux x86-64 stable 二进制安装方式</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -LO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> minikube-linux-amd64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/minikube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> minikube-linux-amd64</span></span></code></pre></div><p>验证 minikube 是否安装成功</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出相关信息就表示安装成功</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1.33.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">commit:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 5883c09216182566a63dff4c326a6fc9ed2982ff</span></span></code></pre></div><h4 id="启动一个-k8s-单机集群" tabindex="-1">启动一个 K8s 单机集群 <a class="header-anchor" href="#启动一个-k8s-单机集群" aria-label="Permalink to &quot;启动一个 K8s 单机集群&quot;">​</a></h4><p>gcr.io/k8s-minikube/kicbase:v0.0.44 这个镜像要是下载不下来可以采用国内相关镜像 docker pull 下载下来进行替换</p><h4 id="下载基础镜像" tabindex="-1">下载基础镜像 <a class="header-anchor" href="#下载基础镜像" aria-label="Permalink to &quot;下载基础镜像&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.cn-hangzhou.aliyuncs.com/google_containers/kicbase:v0.0.44</span></span></code></pre></div><h4 id="打-tag" tabindex="-1">打 tag <a class="header-anchor" href="#打-tag" aria-label="Permalink to &quot;打 tag&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> registry.cn-hangzhou.aliyuncs.com/google_containers/kicbase:v0.0.44</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcr.io/k8s-minikube/kicbase:v0.0.44</span></span></code></pre></div><h4 id="启动集群" tabindex="-1">启动集群 <a class="header-anchor" href="#启动集群" aria-label="Permalink to &quot;启动集群&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">minikube</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --registry-mirror=https://registry.docker-cn.com,https://shraym0v.mirror.aliyuncs.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --embed-certs=true</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --image-mirror-country=cn</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --base-image=gcr.io/k8s-minikube/kicbase:v0.0.44</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers</span></span></code></pre></div><h3 id="kubectl-安装" tabindex="-1">kubectl 安装 <a class="header-anchor" href="#kubectl-安装" aria-label="Permalink to &quot;kubectl 安装&quot;">​</a></h3><p>参考官方文档(<a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux" target="_blank" rel="noreferrer">https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux</a>)</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -LO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://dl.k8s.io/release/$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0755</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/kubectl</span></span></code></pre></div><p>验证 kubectl 是否安装成功</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> version</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出版本信息表示安装成功</span></span></code></pre></div><p>Client Version: v1.30.3 Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3 Server Version: v1.30.0</p><h3 id="部署一个-pod-验证集群" tabindex="-1">部署一个 pod 验证集群 <a class="header-anchor" href="#部署一个-pod-验证集群" aria-label="Permalink to &quot;部署一个 pod 验证集群&quot;">​</a></h3><h4 id="编写-pod-yaml-文件" tabindex="-1">编写 pod yaml 文件 <a class="header-anchor" href="#编写-pod-yaml-文件" aria-label="Permalink to &quot;编写 pod yaml 文件&quot;">​</a></h4><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">v1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-pod</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  labels</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    app</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-app</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  containers</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">my-container</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      image</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">nginx</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      ports</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">containerPort</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span></span></code></pre></div><h4 id="apply-文件" tabindex="-1">apply 文件 <a class="header-anchor" href="#apply-文件" aria-label="Permalink to &quot;apply 文件&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod.yml</span></span></code></pre></div><h4 id="查看-pod-事件消息" tabindex="-1">查看 pod 事件消息 <a class="header-anchor" href="#查看-pod-事件消息" aria-label="Permalink to &quot;查看 pod 事件消息&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pod</span></span></code></pre></div><p>输出如下</p><p><img src="`+e+'" alt="图片"></p>',36),h=[l];function p(k,r,d,o,c,g){return a(),i("div",null,h)}const F=s(t,[["render",p]]);export{u as __pageData,F as default};
